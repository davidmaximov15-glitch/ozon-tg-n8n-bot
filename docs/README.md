# Ozon Telegram Bot - Orders Analytics

–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ CSV-–æ—Ç—á—ë—Ç–æ–≤ Ozon (FBO/FBS) —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –¥–∞—Ç–∞–º –∏ –≤—Ä–µ–º–µ–Ω–∏, –∏ —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- **üì¶ –ê–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ CSV-–æ—Ç—á—ë—Ç–æ–≤ Ozon (FBO/FBS)
- **üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º –∏ –æ–±—â–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º
- **üìÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –í—ã–±–æ—Ä –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ (30-–º–∏–Ω—É—Ç–Ω—ã–π —à–∞–≥)
- **üìà –°—Ä–∞–≤–Ω–µ–Ω–∏–µ**: –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –º–µ–∂–¥—É –¥–∞—Ç–∞–º–∏ —Å —Ä–∞—Å—á—ë—Ç–æ–º –ø—Ä–∏—Ä–æ—Å—Ç–∞/—É–±—ã–ª–∏
- **üéØ –ö–ª–∞—Å—Ç–µ—Ä—ã**: –†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–∑–∞–≥–ª—É—à–∫–∞)
- **‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–ª—ã–º —Å–ø–∏—Å–∫–æ–º –∏ –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞

- ‚úÖ **–ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫**: –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- üëë **–°—É–ø–µ—Ä-–∞–¥–º–∏–Ω—ã**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üë• **–ê–¥–º–∏–Ω—ã**: –ù–∞–∑–Ω–∞—á–∞–µ–º—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Å –ø—Ä–∞–≤–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- üö´ **Rate limiting**: –ó–∞—â–∏—Ç–∞ –æ—Ç —Ñ–ª—É–¥–∞ –∏ —Å–ø–∞–º–∞
- üîí **RBAC**: –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å –¥–æ—Å—Ç—É–ø–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **n8n v1.113.3**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è workflow
- **Telegram Bot API v9.2**: –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–æ—Ç–∞
- **Redis**: –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫—ç—à, ACL
- **MSK Timezone**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –º–æ—Å–∫–æ–≤—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **n8n**: >= 1.113.3
- **Redis**: >= 6.0
- **Node.js**: >= 18.x (–¥–ª—è n8n)
- **Telegram Bot Token**: –°–æ–∑–¥–∞–Ω —á–µ—Ä–µ–∑ @BotFather

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/davidmaximov15-glitch/ozon-tg-n8n-bot.git
cd ozon-tg-n8n-bot
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª
nano .env
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `.env`:

```env
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
SUPER_ADMINS=your_telegram_user_id
REDIS_URL=redis://localhost:6379
```

### 3. –ó–∞–ø—É—Å–∫ Redis

```bash
# Docker
docker run -d -p 6379:6379 --name redis-ozon redis:alpine

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
redis-server
```

### 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis

```bash
chmod +x scripts/redis-init.sh
./scripts/redis-init.sh
```

### 5. –ò–º–ø–æ—Ä—Ç workflow –≤ n8n

1. –û—Ç–∫—Ä–æ–π—Ç–µ n8n UI
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Workflows** ‚Üí **Import from File**
3. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ `workflows/ozon-telegram-bot.json`
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ credentials:
   - **Telegram API**: –î–æ–±–∞–≤—å—Ç–µ Bot Token
   - **Redis**: –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis

### 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

```bash
# –ü–æ–ª—É—á–∏—Ç–µ URL webhook –∏–∑ n8n
WEBHOOK_URL="https://your-n8n-instance.com/webhook/telegram-webhook"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook –¥–ª—è –±–æ—Ç–∞
curl -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/setWebhook" \
  -H "Content-Type: application/json" \
  -d "{\"url\": \"${WEBHOOK_URL}\"}"
```

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ CSV —Ñ–∞–π–ª—ã
chmod +x scripts/test-csv-samples.sh
./scripts/test-csv-samples.sh

# –§–∞–π–ª—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –≤ test-samples/
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∏—Ö –±–æ—Ç—É –≤ Telegram –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
```

## üìö –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ozon-tg-n8n-bot/
‚îú‚îÄ‚îÄ workflows/
‚îÇ   ‚îî‚îÄ‚îÄ ozon-telegram-bot.json      # n8n workflow (–∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π)
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ csv-parser.js               # –ü–∞—Ä—Å–µ—Ä –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ç–æ—Ä CSV
‚îÇ   ‚îú‚îÄ‚îÄ statistics-calculator.js    # –†–∞—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ keyboard-generator.js       # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä Telegram –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ redis-init.sh               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Redis
‚îÇ   ‚îî‚îÄ‚îÄ test-csv-samples.sh         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö CSV
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ README.md                   # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md               # –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
‚îÇ   ‚îî‚îÄ‚îÄ API.md                      # API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ test-samples/                   # –¢–µ—Å—Ç–æ–≤—ã–µ CSV —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ .env.example                    # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                       # –û—Å–Ω–æ–≤–Ω–æ–π README
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|----------|----------------------|
| `TELEGRAM_BOT_TOKEN` | Token Telegram –±–æ—Ç–∞ | - (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) |
| `TELEGRAM_WEBHOOK_URL` | URL –¥–ª—è webhook | - (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) |
| `REDIS_URL` | URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis | `redis://localhost:6379` |
| `SUPER_ADMINS` | ID —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–æ–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) | - (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) |
| `SESSION_TTL` | TTL —Å–µ—Å—Å–∏–∏ (—Å–µ–∫—É–Ω–¥—ã) | `86400` (24 —á–∞—Å–∞) |
| `DATASET_TTL` | TTL –¥–∞—Ç–∞—Å–µ—Ç–∞ (—Å–µ–∫—É–Ω–¥—ã) | `259200` (72 —á–∞—Å–∞) |
| `RATE_LIMIT_MAX_REQUESTS` | –ú–∞–∫—Å. –∑–∞–ø—Ä–æ—Å–æ–≤ | `10` |
| `RATE_LIMIT_WINDOW_SECONDS` | –û–∫–Ω–æ rate limit | `60` |
| `TZ` | –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å | `Europe/Moscow` |

### Redis –∫–ª—é—á–∏

| –ö–ª—é—á | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | TTL |
|------|-----|----------|-----|
| `ozon:dataset:{chat_id}:{session_id}` | String (JSON) | –î–∞—Ç–∞—Å–µ—Ç CSV | 72h |
| `ozon:session:{chat_id}` | String (JSON) | –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ | 24h |
| `ozon:acl:whitelist` | Set | –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ user_id | - |
| `ozon:acl:admins` | Set | –ê–¥–º–∏–Ω—ã user_id | - |
| `ozon:acl:superadmins` | Set | –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω—ã user_id | - |
| `ozon:audit:{YYYY-MM-DD}` | List (JSON) | –õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π –∞–¥–º–∏–Ω–æ–≤ | 30d |

## üìä –§–æ—Ä–º–∞—Ç—ã CSV

### FBO (Fulfillment by Ozon)

```csv
–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞,–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞,–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è,...,–ê—Ä—Ç–∏–∫—É–ª,...,–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ,...,–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏,...,–ö–æ–ª-–≤–æ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
123456,–î–æ—Å—Ç–∞–≤–ª–µ–Ω,2025-09-18 10:00:00,...,ABC-001,...,2,...,1190,...,2
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- **A** (index 0): –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞
- **G** (index 6): –ê—Ä—Ç–∏–∫—É–ª
- **I** (index 8): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ
- **N** (index 13): –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏
- **R** (index 17): –ö–æ–ª-–≤–æ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ —Å—Ä–µ–¥–Ω–µ–π

### FBS (Fulfillment by Seller)

```csv
‚Ññ –∑–∞–∫–∞–∑–∞,–ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞,–ö–æ–ª-–≤–æ,–¶–µ–Ω–∞,–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è,–°—Ç–∞—Ç—É—Å
987654,XYZ-777,1,990,2025-09-18 08:10:00,–î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è
```

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏:**
- –ö–æ–ª–æ–Ω–∫–∞ 0: ‚Ññ –∑–∞–∫–∞–∑–∞
- –ö–æ–ª–æ–Ω–∫–∞ 1: –ê—Ä—Ç–∏–∫—É–ª –ø—Ä–æ–¥–∞–≤—Ü–∞
- –ö–æ–ª–æ–Ω–∫–∞ 2: –ö–æ–ª-–≤–æ
- –ö–æ–ª–æ–Ω–∫–∞ 3: –¶–µ–Ω–∞
- –ö–æ–ª–æ–Ω–∫–∞ 4: –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
- –ö–æ–ª–æ–Ω–∫–∞ 5: –°—Ç–∞—Ç—É—Å

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞

### –ö–æ–º–∞–Ω–¥—ã

- `/start` - –ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

1. **üì¶ –ó–∞–∫–∞–∑—ã** - –ê–Ω–∞–ª–∏–∑ –∑–∞–∫–∞–∑–æ–≤
2. **üéØ –ö–ª–∞—Å—Ç–µ—Ä—ã** - –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
3. **‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)

### –ü—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞

1. –í—ã–±–µ—Ä–∏—Ç–µ **üì¶ –ó–∞–∫–∞–∑—ã**
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ CSV —Ñ–∞–π–ª (FBO –∏–ª–∏ FBS)
3. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø –æ—Ç—á—ë—Ç–∞
4. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É(—ã) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ (1-3 –¥–∞—Ç—ã)
5. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª:
   - –ü–æ —á–∞—Å–∞–º (30-–º–∏–Ω—É—Ç–Ω—ã–π —à–∞–≥)
   - –ü—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–∫–∏: –≤–µ—Å—å –¥–µ–Ω—å, —É—Ç—Ä–æ, –¥–µ–Ω—å, –≤–µ—á–µ—Ä, –Ω–æ—á—å
6. –ü–æ–ª—É—á–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å —Ä–∞–∑–±–∏–≤–∫–æ–π –ø–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∫–ª—é—á–∞–µ—Ç

- **–ü–æ –∞—Ä—Ç–∏–∫—É–ª–∞–º:**
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–∫–∞–∑–æ–≤
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–º–µ–Ω (–≤–∫–ª—é—á–∞—è –≤–æ–∑–≤—Ä–∞—Ç—ã)
  - –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è)
  - –°—É–º–º–∞ –∑–∞–∫–∞–∑–æ–≤
  
- **–û–±—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:**
  - –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤
  - –í—Å–µ–≥–æ –æ—Ç–º–µ–Ω
  - –û–±—â–∞—è —Å—É–º–º–∞
  
- **–ü—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –¥–∞—Ç:**
  - –ü—Ä–∏—Ä–æ—Å—Ç/—É–±—ã–ª—å –≤ —à—Ç—É–∫–∞—Ö
  - –ü—Ä–∏—Ä–æ—Å—Ç/—É–±—ã–ª—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö

## ‚öôÔ∏è –ê–¥–º–∏–Ω–∫–∞

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–æ–≤

1. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏**
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –±–µ–ª–æ–≥–æ —Å–ø–∏—Å–∫–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

2. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏**
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–æ–≤
   - –°–Ω—è—Ç–∏–µ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∞

3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π

### –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π Telegram User ID

```bash
# –û—Ç–ø—Ä–∞–≤—å—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É, –∑–∞—Ç–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
curl "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getUpdates"
```

–ù–∞–π–¥–∏—Ç–µ `"from": {"id": 123456789, ...}` - —ç—Ç–æ –≤–∞—à User ID.

## üîç –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞—Å—á—ë—Ç–æ–≤

### –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–æ–≤

**–í –≤—ã—Ä—É—á–∫—É –≤—Ö–æ–¥—è—Ç:**
- –î–æ—Å—Ç–∞–≤–ª–µ–Ω
- –î–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è
- –û–∂–∏–¥–∞–µ—Ç —Å–±–æ—Ä–∫–∏
- –û–∂–∏–¥–∞–µ—Ç –æ—Ç–≥—Ä—É–∑–∫–∏

**–í –æ—Ç–º–µ–Ω—ã –≤—Ö–æ–¥—è—Ç:**
- –û—Ç–º–µ–Ω—ë–Ω / –û—Ç–º–µ–Ω–µ–Ω
- –í–æ–∑–≤—Ä–∞—Ç

### –°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏

–†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ **—Å—Ä–µ–¥–Ω–µ–≤–∑–≤–µ—à–µ–Ω–Ω–∞—è** –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É:

```
avgPrice = Œ£(price √ó quantity) / Œ£(quantity)
```

–£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ "–≤—ã—Ä—É—á–∫–∞".

### –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã

- **CSV –¥–∞–Ω–Ω—ã–µ**: UTC (–∏–∑ Ozon)
- **–í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: MSK (Europe/Moscow)
- **–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è UTC ‚Üí MSK (+3 —á–∞—Å–∞)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```bash
./scripts/test-csv-samples.sh
```

–°–æ–∑–¥–∞—ë—Ç:
- `test-samples/fbo-sample.csv` (7 –∑–∞–∫–∞–∑–æ–≤, FBO —Ñ–æ—Ä–º–∞—Ç)
- `test-samples/fbs-sample.csv` (7 –∑–∞–∫–∞–∑–æ–≤, FBS —Ñ–æ—Ä–º–∞—Ç)

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π CSV –±–æ—Ç—É
2. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É: 2025-09-18 –∏–ª–∏ 2025-09-19
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (FBO sample)

**–î–∞—Ç–∞ 2025-09-18, –≤–µ—Å—å –¥–µ–Ω—å:**
- ABC-001: 4 –∑–∞–∫–∞–∑–∞, 1 –æ—Ç–º–µ–Ω–∞, ~1190‚ÇΩ —Å—Ä–µ–¥–Ω—è—è
- ABC-002: 5 –∑–∞–∫–∞–∑–æ–≤, 2 –≤–æ–∑–≤—Ä–∞—Ç–∞, ~990‚ÇΩ —Å—Ä–µ–¥–Ω—è—è

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ webhook:
```bash
curl "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/getWebhookInfo"
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ n8n workflow –∞–∫—Ç–∏–≤–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ n8n

### –û—à–∏–±–∫–∞ "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω"

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Redis whitelist:
```bash
redis-cli SMEMBERS ozon:acl:whitelist
```

2. –î–æ–±–∞–≤—å—Ç–µ —Å–≤–æ–π User ID:
```bash
redis-cli SADD ozon:acl:whitelist YOUR_USER_ID
```

### CSV –Ω–µ –ø–∞—Ä—Å–∏—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (UTF-8 —Å BOM –∏–ª–∏ –±–µ–∑)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç FBO/FBS —Ñ–æ—Ä–º–∞—Ç—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª < 20MB

### –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞

–î–∞—Ç–∞—Å–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è 72 —á–∞—Å–∞. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è:
1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ CSV –∑–∞–Ω–æ–≤–æ
2. –ò–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ `DATASET_TTL` –≤ `.env`

## üöÄ Deployment –≤ –ø—Ä–æ–¥–∞–∫—à–Ω

–°–º. –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: [docs/DEPLOYMENT.md](./DEPLOYMENT.md)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSL/TLS –¥–ª—è n8n
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall –¥–ª—è Redis
- –í–∫–ª—é—á–∏—Ç–µ Redis persistence (AOF –∏–ª–∏ RDB)
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã Redis
- Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ nginx/ingress

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### Redis Cluster

–î–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫:
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Redis Cluster –∏–ª–∏ Sentinel
REDIS_URL=redis://redis-cluster:6379
```

### n8n Queue Mode

```bash
# –í–∫–ª—é—á–∏—Ç–µ –æ—á–µ—Ä–µ–¥—å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö CSV
N8N_QUEUE_MODE=true
```

### Load Balancing

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ n8n –∑–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–æ–º:
```
nginx ‚Üí n8n-1, n8n-2, n8n-3 ‚Üí Redis
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è pull requests! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞:

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ feature branch
3. Commit –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. Push –≤ branch
5. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License - —Å–º. [LICENSE](../LICENSE)

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–î–∞–≤–∏–¥ –ú–∞–∫—Å–∏–º–æ–≤ (@davidmaximov15-glitch)

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- GitHub Issues: [github.com/davidmaximov15-glitch/ozon-tg-n8n-bot/issues](https://github.com/davidmaximov15-glitch/ozon-tg-n8n-bot/issues)
- Telegram: @your_support_username

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- n8n team –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
- Telegram Bot API –∑–∞ –º–æ—â–Ω—ã–π API
- Ozon –∑–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –æ—Ç—á—ë—Ç–∞–º–∏
