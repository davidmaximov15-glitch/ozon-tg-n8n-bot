# Commit 03 ‚Äî feat(calendar): 7√ó5 grid + month bounds

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç

- –ó–∞–º–µ–Ω—è–µ—Ç ¬´Generate Date Keyboard¬ª –Ω–∞ **Render Calendar Grid** (7√ó5).
- –î–µ–ª–∞–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º–∏ —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã (–∏–∑ `daysByMonth[month]`).
- –°—Ç—Ä–µ–ª–∫–∏ ‚óÄ/‚ñ∂ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ –∫—Ä–∞—è—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ `noop`).
- –í—ã–≤–æ–¥–∏—Ç –∫–ª–∞–≤–∏—à–∏ ¬´‚úÖ –ì–æ—Ç–æ–≤–æ¬ª –∏ ¬´‚Ü∫ –°–±—Ä–æ—Å¬ª.
- –í—Å–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ **UI Orchestrator (send-or-edit)** –∏–∑ –∫–æ–º–º–∏—Ç–∞ ‚Ññ1.

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–π** `workflows/calendar_render_grid.n8n.json` –≤ n8n.

2. **–°–æ–µ–¥–∏–Ω–∏ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞**:
   - `Ensure Month (smart)` / `Calc Initial Month`
   - `Fetch Session (csv)` –∏ `Get Selected Dates`

3. **–£–¥–∞–ª–∏/–æ—Ç–∫–ª—é—á–∏** —Å—Ç–∞—Ä—ã–π ¬´Generate Date Keyboard¬ª.

4. **–£–±–µ–¥–∏—Å—å, —á—Ç–æ –ø–æ –Ω–∞–∂–∞—Ç–∏—é**:
   - `cal:YYYY-MM:prev|next` ‚Üí —Ä–æ—É—Ç–µ—Ä –º–µ–Ω—è–µ—Ç `month`, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç `Render Calendar Grid`
   - `date:YYYY-MM-DD` ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–≥–≥–ª –∏ **–ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏** –∑–∞–Ω–æ–≤–æ –≤—ã–∑—ã–≤–∞–µ—Ç `Render Calendar Grid` (–±–µ–∑ `sendMessage`)
   - `dates:done` / `dates:reset` ‚Üí –æ—Å—Ç–∞—é—Ç—Å—è –∫–∞–∫ –≤ –ø–ª–∞–Ω–µ; ¬´done¬ª –±—É–¥–µ—Ç –≤–∫–ª—é—á—ë–Ω –≤ –∫–æ–º–º–∏—Ç–∞—Ö 4‚Äì6

5. **–í—Å–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏** –∏–¥—É—Ç —á–µ—Ä–µ–∑ **UI Orchestrator (send-or-edit)** (–∫–æ–º–º–∏—Ç 1).

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
Fetch Session (csv) ‚Üí ozon:sess:<uid>:csv
         +
Get Selected Dates ‚Üí ozon:sess:<uid>:dates
         ‚Üì
Prepare Calendar Model
  - –°–æ–±–∏—Ä–∞–µ—Ç: chat_id, user_id, from, to, month, minMonth, maxMonth
  - –í—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã: selectedDates[]
  - –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞: availDays[] (–∏–∑ daysByMonth[month])
         ‚Üì
Render Calendar Grid
  - –ó–∞–≥–æ–ª–æ–≤–æ–∫: "üìÖ –î–∞—Ç—ã –ø–æ –æ—Ç—á—ë—Ç—É\n–ó–∞–≥—Ä—É–∂–µ–Ω–æ: from ‚Äî to\n–ú–µ—Å—è—Ü: month"
  - –ù–∞–≤–∏–≥–∞—Ü–∏—è: [‚óÄ/‚ñ™] [month] [‚ñ∂/‚ñ™]
    - hasPrev/hasNext –ø—Ä–æ–≤–µ—Ä—è—é—Ç month vs minMonth/maxMonth
    - –ï—Å–ª–∏ –Ω–∞ –∫—Ä–∞—é ‚Üí ‚ñ™ —Å callback_data='noop'
  - –°–µ—Ç–∫–∞ 7√ó5:
    - –ò–¥—ë–º –ø–æ –¥–Ω—è–º 1..total (daysInMonth)
    - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–Ω—è –ø—Ä–æ–≤–µ—Ä—è–µ–º:
      - –ï—Å—Ç—å –≤ availDays ‚Üí –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π (‚òë –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω, ‚ñ´ –µ—Å–ª–∏ –Ω–µ—Ç)
      - –ù–µ—Ç –≤ availDays ‚Üí –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–π ‚Ä¢ —Å noop
      - day > total ‚Üí –ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞ ‚ñ´ —Å noop
  - –ö–Ω–æ–ø–∫–∏: [‚úÖ –ì–æ—Ç–æ–≤–æ] [‚Ü∫ –°–±—Ä–æ—Å]
         ‚Üì
UI Orchestrator (send-or-edit)
  - –í—ã–∑—ã–≤–∞–µ—Ç —Å–∞–±-–≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ –∫–æ–º–º–∏—Ç–∞ 1
  - –î–µ–ª–∞–µ—Ç editMessageText –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
  - –ò–ª–∏ sendMessage –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ—Ç
```

## –§–æ—Ä–º–∞—Ç —Å–µ—Ç–∫–∏ 7√ó5

–ü—Ä–∏–º–µ—Ä –¥–ª—è —Å–µ–Ω—Ç—è–±—Ä—è 2025 (30 –¥–Ω–µ–π):

```
[‚óÄ] [2025-09] [‚ñ∂]

[‚ñ´ 01] [‚ñ´ 02] [‚ñ´ 03] [‚ñ´ 04] [‚ñ´ 05] [‚ñ´ 06] [‚ñ´ 07]
[‚ñ´ 08] [‚ñ´ 09] [‚ñ´ 10] [‚ñ´ 11] [‚ñ´ 12] [‚ñ´ 13] [‚ñ´ 14]
[‚ñ´ 15] [‚ñ´ 16] [‚ñ´ 17] [‚òë 18] [‚òë 19] [‚òë 20] [‚òë 21]
[‚Ä¢ 22] [‚Ä¢ 23] [‚Ä¢ 24] [‚òë 25] [‚òë 26] [‚òë 27] [‚òë 28]
[‚Ä¢ 29] [‚Ä¢ 30] [  ‚ñ´] [  ‚ñ´] [  ‚ñ´] [  ‚ñ´] [  ‚ñ´]

[‚úÖ –ì–æ—Ç–æ–≤–æ] [‚Ü∫ –°–±—Ä–æ—Å]
```

**–õ–µ–≥–µ–Ω–¥–∞:**
- `‚ñ´ DD` ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–µ–Ω—å, –Ω–µ –≤—ã–±—Ä–∞–Ω (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π: `date:YYYY-MM-DD`)
- `‚òë DD` ‚Äî –¥–æ—Å—Ç—É–ø–Ω—ã–π –¥–µ–Ω—å, –≤—ã–±—Ä–∞–Ω (–∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π: `date:YYYY-MM-DD`)
- `‚Ä¢ DD` ‚Äî –¥–µ–Ω—å –≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ç –≤ availableDates) ‚Üí `noop`
- `‚ñ´` (–ø—É—Å—Ç–∞—è —è—á–µ–π–∫–∞) ‚Äî –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–µ—Ç–∫–∏ –¥–æ 7√ó5 ‚Üí `noop`
- `‚ñ™` ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–µ–ª–∫–∞ –Ω–∞ –∫—Ä–∞—é –¥–∏–∞–ø–∞–∑–æ–Ω–∞ ‚Üí `noop`

## –õ–æ–≥–∏–∫–∞ callback_data

| –î–µ–π—Å—Ç–≤–∏–µ | callback_data | –û–±—Ä–∞–±–æ—Ç–∫–∞ |
|----------|--------------|-----------|
| –ö–ª–∏–∫ –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –¥–Ω—é | `date:YYYY-MM-DD` | Toggle + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ + re-render |
| –ö–ª–∏–∫ –ø–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–º—É –¥–Ω—é | `noop` | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è |
| –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ (–µ—Å—Ç—å prev) | `cal:YYYY-MM:prev` | –í—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü + re-render |
| –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ (–Ω–∞ –∫—Ä–∞—é) | `noop` | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è |
| –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ (–µ—Å—Ç—å next) | `cal:YYYY-MM:next` | –í—ã—á–∏—Å–ª–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü + re-render |
| –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ (–Ω–∞ –∫—Ä–∞—é) | `noop` | –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è |
| –ì–æ—Ç–æ–≤–æ | `dates:done` | –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ (–∫–æ–º–º–∏—Ç 4-6) |
| –°–±—Ä–æ—Å | `dates:reset` | –û—á–∏—Å—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–∞—Ç + re-render |

## –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –≤–∫–∞—Ç–∞

- ‚úÖ **–ù–∞ –ø–µ—Ä–≤–æ–º –º–µ—Å—è—Ü–µ** (month === minMonth):
  - –°—Ç—Ä–µ–ª–∫–∞ –≤–ª–µ–≤–æ: `‚ñ™` —Å `callback_data='noop'`
  
- ‚úÖ **–ù–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–º –º–µ—Å—è—Ü–µ** (month === maxMonth):
  - –°—Ç—Ä–µ–ª–∫–∞ –≤–ø—Ä–∞–≤–æ: `‚ñ™` —Å `callback_data='noop'`

- ‚úÖ **–î–Ω–∏ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö** (–Ω–µ –≤ availableDates):
  - –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫–∞–∫ `‚Ä¢ DD` —Å `callback_data='noop'`
  - –ö–ª–∏–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

- ‚úÖ **–ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏** –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞:
  - –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ 7√ó5: `‚ñ´` —Å `callback_data='noop'`

- ‚úÖ **–°–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ** –æ—Å—Ç–∞—ë—Ç—Å—è **–æ–¥–Ω–∏–º**:
  - –ì—Ä–∏–¥ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `editMessageText`
  - UI Orchestrator –∏–∑ –∫–æ–º–º–∏—Ç–∞ 1 —É–ø—Ä–∞–≤–ª—è–µ—Ç send-or-edit –ª–æ–≥–∏–∫–æ–π

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —É–∑–ª–∞–º–∏

### –í—Ö–æ–¥–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- `Extract User Data` ‚Üí chat_id, user_id
- `Ensure Month (smart)` / `Calc Initial Month` ‚Üí month, minMonth, maxMonth
- `Fetch Session (csv)` ‚Üí {from, to, months[], daysByMonth{}}
- `Get Selected Dates` ‚Üí selectedDates[]

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
- `Render Calendar Grid` ‚Üí {chat_id, text, reply_markup}
- `UI Orchestrator` ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è

### –ó–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä—ã—Ö —É–∑–ª–æ–≤:
- ‚ùå –£–¥–∞–ª–∏—Ç—å: `Generate Date Keyboard` (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
- ‚ùå –£–¥–∞–ª–∏—Ç—å: –ü—Ä—è–º—ã–µ `sendMessage` –¥–ª—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å: `Render Calendar Grid` + `UI Orchestrator`

## –°–≤—è–∑—å —Å –ø–ª–∞–Ω–æ–º

- ‚úÖ **–ó–∞–º–µ–Ω–∞** `Generate Date Keyboard` ‚Üí `Render Calendar Grid`
- ‚úÖ **–ù–∞–≤–∏–≥–∞—Ü–∏—è** –∏ `noop` –Ω–∞ –∫—Ä–∞—è—Ö (minMonth/maxMonth)
- ‚úÖ **–ú–æ–¥–µ–ª—å** `{from, to, months, daysByMonth}` –∏–∑ —Å–µ—Å—Å–∏–∏
- ‚úÖ **–¢–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞—Ç—ã** –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã (–∏–∑ daysByMonth[month])
- ‚úÖ **7√ó5 —Å–µ—Ç–∫–∞** —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –ø—É—Å—Ç—ã—Ö —è—á–µ–µ–∫
- ‚úÖ **–ü—Ä–∏–≥–ª—É—à—ë–Ω–Ω—ã–µ –¥–Ω–∏** (‚Ä¢) –¥–ª—è –¥–∞—Ç –≤–Ω–µ –¥–∞–Ω–Ω—ã—Ö

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- **–ö–æ–º–º–∏—Ç ‚Ññ4**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (`cal:prev/next`) –∏ —Ç–æ–≥–≥–ª–∞ –¥–∞—Ç
- **–ö–æ–º–º–∏—Ç ‚Ññ5**: –ö—Ä–∞—Å–∏–≤–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ + —Å—á—ë—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞
- **–ö–æ–º–º–∏—Ç ‚Ññ6**: –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ ¬´–ì–æ—Ç–æ–≤–æ¬ª
